<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test de Localisation DoV</title>
    <style>
        body { background: #222; color: #fff; font-family: monospace; padding: 20px; }
        .box { border: 1px solid #555; padding: 20px; max-width: 800px; margin: 0 auto; }
        button { padding: 10px 20px; cursor: pointer; background: #e67e22; color: white; border: none; font-size: 16px; margin: 10px 0; }
        .result { background: black; padding: 15px; border: 1px solid #444; min-height: 100px; white-space: pre-wrap; color: #0f0; }
        .error { color: #ff5555; }
    </style>
</head>
<body>

<div class="box">
    <h1>TEST DE LOCALISATION</h1>
    <p>On ne filtre pas. On regarde juste ce qu'il y a dans la table.</p>

    <h3>Test 1 : Scope "dovpvecontrl" (Le dossier public)</h3>
    <button onclick="testScope('dovpvecontrl')">SCANNER LE DOSSIER PUBLIC</button>

    <h3>Test 2 : Scope "u2d2k.c.wam" (Ton dossier perso)</h3>
    <input type="text" id="userInput" value="u2d2k.c.wam" style="padding:5px; color:black;">
    <button onclick="testScope(document.getElementById('userInput').value)">SCANNER LE DOSSIER PERSO</button>

    <div id="console" class="result">En attente...</div>
</div>

<script>
    const RPC = "https://api.waxsweden.org/v1/chain/get_table_rows";

    async function testScope(scopeName) {
        const consoleDiv = document.getElementById('console');
        consoleDiv.innerHTML = `> Scan du scope : "${scopeName}"...\n`;

        try {
            const response = await fetch(RPC, {
                method: 'POST',
                body: JSON.stringify({
                    json: true,
                    code: "dovpvecontrl", // Le contrat
                    table: "sdivisions",  // La table
                    scope: scopeName,     // L'endroit où on cherche
                    limit: 10             // Juste les 10 premiers résultats
                })
            });

            if (!response.ok) throw new Error("Erreur HTTP " + response.status);
            const data = await response.json();

            if (!data.rows || data.rows.length === 0) {
                consoleDiv.innerHTML += `<span class="error">VIDE. Aucune donnée trouvée dans "${scopeName}".</span>\n`;
            } else {
                consoleDiv.innerHTML += `SUCCÈS ! ${data.rows.length} lignes trouvées.\n`;
                consoleDiv.innerHTML += `----------------------------------------\n`;
                
                // Afficher le contenu brut pour voir la structure
                data.rows.forEach((row, index) => {
                    consoleDiv.innerHTML += `[${index}] Propriétaire: ${row.user} | ID Div: ${row.division_id} | Assets: ${row.asset_ids.length}\n`;
                });
                
                consoleDiv.innerHTML += `----------------------------------------\n`;
                consoleDiv.innerHTML += `CONCLUSION : Les données sont bien ici.`;
            }

        } catch (e) {
            consoleDiv.innerHTML += `<span class="error">ERREUR TECHNIQUE : ${e.message}</span>`;
        }
    }
</script>

</body>
</html>
