<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>DoV - COMMAND V259 (FULL SUITE)</title>
    <style>
        /* --- FINANCIAL DARK THEME --- */
        :root { --bg: #0b0c10; --panel: #13141b; --border: #2d2e3a; --green: #00f090; --red: #ff3b30; --blue: #2979ff; --purple: #d500f9; --orange: #ff9100; --text: #858595; --white: #e0e0e0; --font: 'Inter', sans-serif; --mono: 'JetBrains Mono', monospace; }
        body { background: var(--bg); color: var(--text); font-family: var(--font); margin: 0; height: 100vh; display: flex; font-size: 11px; overflow: hidden; }
        * { box-sizing: border-box; }
        ::-webkit-scrollbar { width: 5px; } ::-webkit-scrollbar-thumb { background: #333; }

        .sidebar { width: 250px; background: var(--panel); border-right: 1px solid var(--border); padding: 15px; display: flex; flex-direction: column; gap: 15px; flex-shrink: 0; }
        .main { flex: 1; padding: 25px; overflow-y: auto; background: linear-gradient(180deg, var(--bg) 0%, #08080a 100%); }

        /* WIDGETS */
        .btn-row { display: flex; gap: 8px; }
        button { flex: 1; padding: 10px; border: none; border-radius: 3px; font-weight: 800; font-size: 10px; cursor: pointer; text-transform: uppercase; color: #000; transition: 0.2s; }
        button:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .btn-green { background: var(--green); } .btn-red { background: rgba(255,59,48,0.2); color: var(--red); border: 1px solid var(--red); }
        .btn-blue { background: var(--blue); color: #fff; } .btn-ghost { background: transparent; border: 1px solid #333; color: #888; }
        
        input { background: #000; border: 1px solid #333; color: #fff; padding: 8px; width: 100%; font-family: var(--mono); text-align: center; }
        .grp-lbl { font-size: 9px; font-weight: 700; color: #555; text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 5px; }

        /* DASHBOARD */
        .header { display: flex; justify-content: space-between; align-items: flex-end; padding-bottom: 20px; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
        .h-title { font-size: 20px; font-weight: 900; color: #fff; margin: 0; }
        .h-meta { font-family: var(--mono); color: #666; margin-top: 5px; }
        
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
        .kpi-card { background: var(--panel); border: 1px solid var(--border); padding: 15px; border-radius: 4px; position: relative; overflow: hidden; }
        .kpi-card::before { content:''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px; background: #333; }
        .k-val { font-family: var(--mono); font-size: 20px; font-weight: 700; color: #fff; margin-top: 5px; }
        .k-lbl { font-size: 10px; font-weight: 700; color: #666; text-transform: uppercase; }

        /* LISTS */
        .zones-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .zone-card { background: var(--panel); border: 1px solid var(--border); padding: 10px; border-radius: 4px; height: 160px; display: flex; flex-direction: column; justify-content: space-between; }
        .active-zone { border-color: var(--blue); background: rgba(41, 121, 255, 0.05); }
        .zc-head { display: flex; justify-content: space-between; font-weight: 700; color: #fff; border-bottom: 1px solid #333; padding-bottom: 5px; margin-bottom: 5px; }
        .zc-stat { display: flex; justify-content: space-between; font-family: var(--mono); font-size: 10px; color: #888; margin-bottom: 3px; }
        
        .row-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #222; font-family: var(--mono); color: #aaa; font-size: 11px; }
        .row-item:hover { background: #1a1a20; color: #fff; }

        .val-f { color: var(--green); } .val-w { color: var(--blue); } .val-c { color: var(--orange); } .val-r { color: var(--purple); }
        .view-section { display: none; } .active { display: block; }

        /* MODAL */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 99; justify-content: center; align-items: center; }
        .modal- content { width: 600px; background: var(--panel); border: 1px solid var(--border); padding: 20px; }
        textarea { width: 100%; height: 100px; background: #000; border: 1px solid #333; color: #ccc; font-family: var(--mono); }
    </style>
</head>
<body>

<div class="layout">
    <div class="sidebar">
        <div style="color:#fff; font-weight:800; font-size:14px;">DOV COMMAND <span style="opacity:0.5">V259</span></div>
        
        <div>
            <span class="grp-lbl">TARGET WALLET</span>
            <input type="text" id="targetIn" value="u2d2k.c.wam">
        </div>

        <div>
            <span class="grp-lbl">SCAN ACTIONS</span>
            <div class="btn-row">
                <button class="btn-green" onclick="startBuildingScan()">BUILDINGS</button>
                <button class="btn-red" onclick="stopSignal=true">STOP</button>
            </div>
            <div style="height:10px"></div>
            <div class="btn-row">
                <button class="btn-blue" onclick="startZoneScan()">ZONES (FIGHT)</button>
            </div>
        </div>

        <div style="margin-top:auto">
            <button class="btn-ghost" onclick="openSettings()">SETTINGS</button>
            <button class="btn-ghost" style="color:var(--red); border-color:var(--red); margin-top:5px;" onclick="hardReset()">RESET</button>
        </div>
    </div>

    <div class="main">
        <div id="viewZones" class="view-section">
            <div class="header">
                <div><h1 class="h-title">ZONE TACTICAL MAP</h1><div class="h-meta" id="zoneStatus">Ready.</div></div>
                <div style="text-align:right"><div class="grp-lbl">ACTIVE UNITS</div><div class="k-val" id="zTotalActive">0</div></div>
            </div>
            <div class="kpi-grid" style="grid-template-columns: repeat(3, 1fr);">
                <div class="kpi-card" style="border-left:3px solid var(--green)"><div class="k-lbl">TOTAL IN FIGHT</div><div class="k-val val-f" id="kpiFight">0</div></div>
                <div class="kpi-card" style="border-left:3px solid var(--blue)"><div class="k-lbl">TOTAL WEIGHT</div><div class="k-val val-w" id="kpiWeight">0</div></div>
                <div class="kpi-card" style="border-left:3px solid var(--purple)"><div class="k-lbl">DOVX YIELD / 24H</div><div class="k-val val-r" id="kpiReward">0</div></div>
            </div>
            <div class="zones-grid" id="areaZones"></div>
        </div>

        <div id="viewBuildings" class="view-section active">
            <div class="header">
                <div><h1 class="h-title">BUILDING PRODUCTION</h1><div class="h-meta" id="buildStatus">Ready.</div></div>
                <div style="text-align:right"><div class="grp-lbl">MAINTENANCE / 24H</div><div class="k-val val-r" id="gTotalCost">0 DOVX</div></div>
            </div>
            <div class="kpi-grid">
                <div class="kpi-card" style="border-left:3px solid var(--orange)"><div class="k-lbl">FUEL / H</div><div class="k-val val-c" id="prodF">0</div></div>
                <div class="kpi-card" style="border-left:3px solid var(--red)"><div class="k-lbl">HEALTH / H</div><div class="k-val val-f" id="prodH">0</div></div>
                <div class="kpi-card" style="border-left:3px solid var(--blue)"><div class="k-lbl">REPAIR / H</div><div class="k-val val-w" id="prodR">0</div></div>
                <div class="kpi-card" style="border-left:3px solid var(--yellow)"><div class="k-lbl">SUPPLY / H</div><div class="k-val val-c" id="prodS">0</div></div>
            </div>
            <div class="grp-lbl">ASSETS INVENTORY</div>
            <div id="buildList" style="background:var(--panel); border:1px solid var(--border); border-radius:4px; min-height:200px;"></div>
        </div>
    </div>
</div>

<div class="modal" id="settingsModal"><div class="modal- content"><h3 style="color:#fff; margin-top:0">CONFIG</h3><textarea id="cfgData"></textarea><br><br><button class="btn-green" onclick="saveConfig()">SAVE</button> <button class="btn-ghost" onclick="closeModal()">CANCEL</button></div></div>

<script>
    const STORAGE_KEY = 'DOV_V259_DATA';
    let stopSignal = false;
    
    // FULL DATA SET
    const DEFAULT_DATA = {
        nodes: ["https://wax.greymass.com", "https://wax.eosio.online", "https://api.wax.alohaeos.com"],
        game: { maintenance: 0.085 },
        zones: { 
            1: {name:"Beach 1", cost:1160, win:400, min:0}, 2: {name:"Beach 2", cost:6968, win:2405, min:0},
            3: {name:"Beach 3", cost:8800, win:3037, min:0}, 4: {name:"Bunker", cost:11120, win:3838, min:90},
            5: {name:"Forest 1", cost:14024, win:4840, min:3}, 6: {name:"Forest 2", cost:17704, win:6110, min:3},
            7: {name:"Forest 3", cost:22352, win:7714, min:3}, 8: {name:"Camp", cost:28220, win:9739, min:90},
            9: {name:"Hill 1", cost:37052, win:12788, min:3}, 10: {name:"Hill 2", cost:48652, win:16791, min:3},
            11: {name:"Hill 3", cost:64516, win:22266, min:3}, 12: {name:"Radar", cost:84712, win:29236, min:90},
            13: {name:"Plain 1", cost:99384, win:34300, min:0}, 14: {name:"Plain 2", cost:125708, win:43385, min:0},
            15: {name:"Plain 3", cost:151164, win:52171, min:0}, 16: {name:"HQ", cost:188000, win:64884, min:0},
            17:{name:"City 1",cost:0,win:0,min:0}, 18:{name:"City 2",cost:0,win:0,min:0}, 19:{name:"City 3",cost:0,win:0,min:0}, 20:{name:"City 4",cost:0,win:0,min:0}
        },
        templates: {
            "490122": { "name": "C_F1_PRODUCER_FUEL", "prod": 5.4 }, "492383": { "name": "C_F1_PRODUCER_FUEL", "prod": 5.4 },
            "492385": { "name": "C_F2_PRODUCER_FUEL", "prod": 12.15 }, "492363": { "name": "C_F2_PRODUCER_FUEL (VAR)", "prod": 12.15 },
            "492366": { "name": "C_F3_PRODUCER_FUEL (VAR)", "prod": 30.38 }, "492397": { "name": "C_F4_PRODUCER_FUEL", "prod": 83.53 }, 
            "492368": { "name": "C_F4_PRODUCER_FUEL", "prod": 83.53 }, "492373": { "name": "R_F1_PRODUCER_FUEL", "prod": 16.20 }, 
            "492379": { "name": "R_F1_PRODUCER_FUEL", "prod": 16.20 }, "492376": { "name": "R_F2_PRODUCER_FUEL", "prod": 36.45 }, 
            "492386": { "name": "R_F3_PRODUCER_FUEL", "prod": 91.13 }, "492390": { "name": "R_F4_PRODUCER_FUEL", "prod": 250.59 }, 
            "492380": { "name": "E_F1_PRODUCER_FUEL", "prod": 48.60 }, "492381": { "name": "E_F2_PRODUCER_FUEL", "prod": 109.35 }, 
            "492387": { "name": "E_F3_PRODUCER_FUEL", "prod": 273.38 }, "492388": { "name": "E_F4_PRODUCER_FUEL", "prod": 751.78 }, 
            "492389": { "name": "L_F1_PRODUCER_FUEL", "prod": 145.80 }, "492370": { "name": "L_F2_PRODUCER_FUEL", "prod": 328.05 },
            "492372": { "name": "L_F3_PRODUCER_FUEL", "prod": 820.13 }, "544068": { "name": "S1_OWNER_FUEL", "prod": 2255.34 },
            "492392": { "name": "S1_OWNER_FUEL (VAR)", "prod": 2255.34 }, "492377": { "name": "SC_F2_PRODUCER_FUEL", "prod": 54.00 },
            "492391": { "name": "SC_F3_PRODUCER_FUEL", "prod": 121.50 },
            "492394": { "name": "C_F1_PRODUCER_HEALTH", "prod": 5.4 }, "492395": { "name": "C_F2_PRODUCER_HEALTH", "prod": 12.15 },
            "492396": { "name": "C_F3_PRODUCER_HEALTH", "prod": 30.38 }, "492399": { "name": "R_F1_PRODUCER_HEALTH", "prod": 16.20 },
            "492401": { "name": "R_F2_PRODUCER_HEALTH", "prod": 36.45 }, "492535": { "name": "R_F3_PRODUCER_HEALTH", "prod": 91.13 },
            "492537": { "name": "R_F4_PRODUCER_HEALTH", "prod": 250.59 }, "492539": { "name": "E_F1_PRODUCER_HEALTH", "prod": 48.60 },
            "492543": { "name": "E_F2_PRODUCER_HEALTH", "prod": 109.35 }, "492545": { "name": "E_F3_PRODUCER_HEALTH", "prod": 273.38 },
            "492546": { "name": "E_F4_PRODUCER_HEALTH", "prod": 751.78 }, "492550": { "name": "L_F1_PRODUCER_HEALTH", "prod": 145.80 },
            "492554": { "name": "L_F2_PRODUCER_HEALTH", "prod": 328.05 }, "492555": { "name": "L_F3_PRODUCER_HEALTH", "prod": 820.13 },
            "544070": { "name": "S1_OWNER_HEALTH", "prod": 2255.34 }, "492460": { "name": "C_F1_PRODUCER_REPAIR", "prod": 5.4 },
            "492559": { "name": "C_F1_PRODUCER_REPAIR", "prod": 5.4 }, "492461": { "name": "C_F2_PRODUCER_REPAIR", "prod": 12.15 },
            "492560": { "name": "C_F2_PRODUCER_REPAIR", "prod": 12.15 }, "492462": { "name": "C_F3_PRODUCER_REPAIR", "prod": 30.38 },
            "492561": { "name": "C_F3_PRODUCER_REPAIR", "prod": 30.38 }, "492463": { "name": "C_F4_PRODUCER_REPAIR", "prod": 83.53 },
            "492562": { "name": "C_F4_PRODUCER_REPAIR", "prod": 83.53 }, "492464": { "name": "R_F1_PRODUCER_REPAIR", "prod": 16.20 },
            "492563": { "name": "R_F1_PRODUCER_REPAIR", "prod": 16.20 }, "492465": { "name": "R_F2_PRODUCER_REPAIR", "prod": 36.45 },
            "492565": { "name": "R_F2_PRODUCER_REPAIR", "prod": 36.45 }, "492466": { "name": "R_F3_PRODUCER_REPAIR", "prod": 91.13 },
            "492566": { "name": "R_F3_PRODUCER_REPAIR", "prod": 91.13 }, "492467": { "name": "R_F4_PRODUCER_REPAIR", "prod": 250.59 },
            "492568": { "name": "R_F4_PRODUCER_REPAIR", "prod": 250.59 }, "492469": { "name": "E_F1_PRODUCER_REPAIR", "prod": 48.60 },
            "492964": { "name": "E_F1_PRODUCER_REPAIR", "prod": 48.60 }, "492471": { "name": "E_F2_PRODUCER_REPAIR", "prod": 109.35 },
            "492965": { "name": "E_F2_PRODUCER_REPAIR", "prod": 109.35 }, "492472": { "name": "E_F3_PRODUCER_REPAIR", "prod": 273.38 },
            "492966": { "name": "E_F3_PRODUCER_REPAIR", "prod": 273.38 }, "492473": { "name": "E_F4_PRODUCER_REPAIR", "prod": 751.78 },
            "492967": { "name": "E_F4_PRODUCER_REPAIR", "prod": 751.78 }, "492474": { "name": "L_F1_PRODUCER_REPAIR", "prod": 145.80 },
            "492572": { "name": "L_F1_PRODUCER_REPAIR", "prod": 145.80 }, "492475": { "name": "L_F2_PRODUCER_REPAIR", "prod": 328.05 },
            "492579": { "name": "L_F2_PRODUCER_REPAIR", "prod": 328.05 }, "492476": { "name": "L_F3_PRODUCER_REPAIR", "prod": 820.13 },
            "492582": { "name": "L_F3_PRODUCER_REPAIR", "prod": 820.13 }, "544071": { "name": "S1_OWNER_REPAIR", "prod": 2255.34 },
            "544061": { "name": "S1_OWNER_REPAIR", "prod": 2255.34 }, "492583": { "name": "L_F4_PRODUCER_REPAIR", "prod": 2255.34 },
            "492507": { "name": "C_F1_PRODUCER_SUPPLY", "prod": 5.4 }, "492585": { "name": "C_F1_PRODUCER_SUPPLY", "prod": 5.4 },
            "492509": { "name": "C_F2_PRODUCER_SUPPLY", "prod": 12.15 }, "492587": { "name": "C_F2_PRODUCER_SUPPLY", "prod": 12.15 },
            "492511": { "name": "C_F3_PRODUCER_SUPPLY", "prod": 30.38 }, "492589": { "name": "C_F3_PRODUCER_SUPPLY", "prod": 30.38 },
            "492513": { "name": "C_F4_PRODUCER_SUPPLY", "prod": 83.53 }, "492702": { "name": "C_F4_PRODUCER_SUPPLY", "prod": 83.53 },
            "492515": { "name": "R_F1_PRODUCER_SUPPLY", "prod": 16.20 }, "492703": { "name": "R_F1_PRODUCER_SUPPLY", "prod": 16.20 },
            "492518": { "name": "R_F2_PRODUCER_SUPPLY", "prod": 36.45 }, "492704": { "name": "R_F2_PRODUCER_SUPPLY", "prod": 36.45 },
            "492521": { "name": "R_F3_PRODUCER_SUPPLY", "prod": 91.13 }, "492706": { "name": "R_F3_PRODUCER_SUPPLY", "prod": 91.13 },
            "492523": { "name": "R_F4_PRODUCER_SUPPLY", "prod": 250.59 }, "492707": { "name": "R_F4_PRODUCER_SUPPLY", "prod": 250.59 },
            "492526": { "name": "E_F1_PRODUCER_SUPPLY", "prod": 48.60 }, "492708": { "name": "E_F1_PRODUCER_SUPPLY", "prod": 48.60 },
            "492528": { "name": "E_F2_PRODUCER_SUPPLY", "prod": 109.35 }, "492709": { "name": "E_F2_PRODUCER_SUPPLY", "prod": 109.35 },
            "492529": { "name": "E_F3_PRODUCER_SUPPLY", "prod": 273.38 }, "492710": { "name": "E_F3_PRODUCER_SUPPLY", "prod": 273.38 },
            "492530": { "name": "E_F4_PRODUCER_SUPPLY", "prod": 751.78 }, "492711": { "name": "E_F4_PRODUCER_SUPPLY", "prod": 751.78 },
            "492532": { "name": "L_F1_PRODUCER_SUPPLY", "prod": 145.80 }, "492712": { "name": "L_F1_PRODUCER_SUPPLY", "prod": 145.80 },
            "492533": { "name": "L_F2_PRODUCER_SUPPLY", "prod": 328.05 }, "492713": { "name": "L_F2_PRODUCER_SUPPLY", "prod": 328.05 },
            "492534": { "name": "L_F3_PRODUCER_SUPPLY", "prod": 820.13 }, "492714": { "name": "L_F3_PRODUCER_SUPPLY", "prod": 820.13 },
            "492715": { "name": "L_F4_PRODUCER_SUPPLY", "prod": 2255.34 }, "544069": { "name": "S1_OWNER_SUPPLY", "prod": 2255.34 }, "544064": { "name": "S1_OWNER_SUPPLY", "prod": 2255.34 }
        }
    };
    
    let DATA = JSON.parse(JSON.stringify(DEFAULT_DATA));

    function init() {
        let s = localStorage.getItem(STORAGE_KEY);
        if(s) { try { DATA = JSON.parse(s); } catch(e){} }
        // INIT UI
        renderZones({});
    }

    async function fetchTable(code, scope, table, lower="") {
        for(let node of DATA.nodes) {
            try {
                let r = await fetch(node + "/v1/chain/get_table_rows", {
                    method: 'POST', body: JSON.stringify({json:true, code, scope, table, limit:1000, lower_bound:lower})
                });
                if(r.ok) return await r.json();
            } catch(e){}
        }
        return {rows:[]};
    }

    function switchView(v) {
        document.querySelectorAll('.view-section').forEach(e => e.classList.remove('active'));
        document.getElementById(v).classList.add('active');
    }

    // --- ZONE SCANNER ---
    async function startZoneScan() {
        switchView('viewZones');
        stopSignal = false;
        const target = document.getElementById('targetIn').value.trim();
        document.getElementById('zoneStatus').innerText = "SCANNING: " + target + "...";
        
        let stats = { fight:0, weight:0, reward:0, total:0 };
        let zMap = {}; Object.keys(DATA.zones).forEach(k => zMap[k] = {active:0, total:0, weight:0});

        let next = "";
        while(!stopSignal) {
            let res = await fetchTable("dovpvecontrl", target, "sdivisions", next);
            if(!res.rows.length) break;

            const now = Date.now()/1000;
            for(let r of res.rows) {
                let zid = r.zone_id || r.zoneID;
                if(!zMap[zid]) continue;

                zMap[zid].total++;
                stats.total++;

                let end = 0;
                if(r.unlock_time) end = parseFloat(r.unlock_time);
                else if(r.end_time) end = parseFloat(r.end_time);
                
                let isActive = end > 1000000000000 ? end > Date.now() : end > now;

                if(isActive) {
                    zMap[zid].active++;
                    stats.fight++;
                    let w = parseFloat(r.weight || 0);
                    zMap[zid].weight += w;
                    stats.weight += w;
                    stats.reward += DATA.zones[zid].win;
                }
            }
            renderZones(zMap);
            updateZoneStats(stats);
            if(res.more) next = res.next_key; else break;
            await new Promise(r => setTimeout(r, 100));
        }
        document.getElementById('zoneStatus').innerText = "SCAN COMPLETE.";
    }

    // --- BUILDING SCANNER ---
    async function startBuildingScan() {
        switchView('viewBuildings');
        stopSignal = false;
        const target = document.getElementById('targetIn').value.trim();
        document.getElementById('buildStatus').innerText = "SCANNING: " + target + "...";
        document.getElementById('buildList').innerHTML = "";

        let totals = { F:0, H:0, R:0, S:0, cost:0 };
        let next = "";
        
        while(!stopSignal) {
            let res = await fetchTable("dovutilstake", target, "buildings", next);
            if(!res.rows.length) break;

            const now = Date.now()/1000;
            let html = "";

            for(let r of res.rows) {
                let count = r.asset_ids ? r.asset_ids.length : 1;
                let tpl = DATA.templates[r.template_id] || {name:r.template_id, prod:0};
                
                // Real-time production check
                let last = parseFloat(r.last_claim);
                let delay = parseFloat(r.delay);
                let active = (now < last + delay);
                
                let hourly = count * tpl.prod;
                let dailyCost = (hourly * 24 * 0.085); // Estimated cost

                if(active) {
                    if(tpl.name.includes("FUEL")) totals.F += hourly;
                    else if(tpl.name.includes("HEALTH")) totals.H += hourly;
                    else if(tpl.name.includes("REPAIR")) totals.R += hourly;
                    else if(tpl.name.includes("SUPPLY")) totals.S += hourly;
                    totals.cost += dailyCost;
                }

                html += `<div class="row-item">
                    <span style="width:200px; color:${active?'#fff':'#555'}">${tpl.name}</span>
                    <span style="width:50px; text-align:center">${count}</span>
                    <span style="width:80px; text-align:right">${active ? hourly.toFixed(2) : '0.00'}/h</span>
                </div>`;
            }
            document.getElementById('buildList').innerHTML += html;
            updateBuildStats(totals);

            if(res.more) next = res.next_key; else break;
            await new Promise(r => setTimeout(r, 100));
        }
        document.getElementById('buildStatus').innerText = "SCAN COMPLETE.";
    }

    function renderZones(map) {
        let html = "";
        Object.keys(DATA.zones).forEach(id => {
            let z = DATA.zones[id];
            let d = map[id] || {active:0, total:0, weight:0};
            let cls = d.active > 0 ? "active-zone" : "";
            let burn = d.active * z.cost;
            let gain = d.active * z.win;
            html += `
            <div class="zone-card ${cls}">
                <div class="zc-head"><span>${z.name}</span><span class="${d.active>0?'val-f':''}">${d.active}/${d.total}</span></div>
                <div class="zc-mid">
                    <div class="zc-stat"><span>WEIGHT</span> <span class="val-w">${d.weight}</span></div>
                    <div class="zc-stat"><span>YIELD</span> <span class="val-r">+${gain.toLocaleString()}</span></div>
                    <div class="zc-stat"><span>BURN</span> <span class="val-c">-${burn.toLocaleString()}</span></div>
                </div>
                <div class="zc-stat" style="margin-top:auto"><span>REQ: ${z.min}W</span> <span class="val-f">WIN: ${z.win}</span></div>
            </div>`;
        });
        document.getElementById('areaZones').innerHTML = html;
    }

    function updateZoneStats(s) {
        document.getElementById('zTotalActive').innerText = s.total;
        document.getElementById('kpiFight').innerText = s.fight;
        document.getElementById('kpiWeight').innerText = s.weight;
        document.getElementById('kpiReward').innerText = s.reward.toLocaleString();
    }

    function updateBuildStats(t) {
        document.getElementById('prodF').innerText = t.F.toFixed(1);
        document.getElementById('prodH').innerText = t.H.toFixed(1);
        document.getElementById('prodR').innerText = t.R.toFixed(1);
        document.getElementById('prodS').innerText = t.S.toFixed(1);
        document.getElementById('gTotalCost').innerText = t.cost.toFixed(0) + " DOVX";
    }

    function dispatchGlobalScan() { startBuildingScan(); } // Alias
    function startEconomyScan() { alert("Coming soon"); }
    function openSettings() { document.getElementById('cfgData').value = JSON.stringify(DATA, null, 4); document.getElementById('settingsModal').style.display = 'flex'; }
    function saveConfig() { try { DATA = JSON.parse(document.getElementById('cfgData').value); localStorage.setItem(STORAGE_KEY, JSON.stringify(DATA)); document.getElementById('settingsModal').style.display = 'none'; renderZones({}); } catch(e){ alert("JSON Invalid"); } }
    function closeModal() { document.getElementById('settingsModal').style.display = 'none'; }
    function hardReset() { if(confirm("RESET?")) { localStorage.removeItem(STORAGE_KEY); location.reload(); } }

    window.onload = init;
</script>
</body>
</html>
